<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE HUNT - Blade Runner</title>
    <link rel="stylesheet" href="blade-runner.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="assets/js/atmosphere.js"></script>
</head>
<body>
    <div class="neon-grid"></div>
    
    <div class="audio-indicator" id="audioIndicator">♪ VANGELIS SOUNDTRACK ♪</div>
    
    <div class="container">
        <header class="header">
            <h1 class="main-title">SECTOR 7-G</h1>
            <div class="subtitle">
                <p class="cyberpunk-text">NEURAL LINK ESTABLISHED</p>
                <p class="mission-text">ACCESS GRANTED - CONTINUE PROTOCOL</p>
            </div>
        </header>
        
        <main class="main-content">
            <div class="terminal-container">
                <div class="terminal-header">
                    <span class="terminal-title">TYRELL CORPORATION - SYSTEM ACCESS</span>
                    <div class="terminal-controls">
                        <span class="control minimize"></span>
                        <span class="control maximize"></span>
                        <span class="control close"></span>
                    </div>
                </div>
                <div class="terminal-content">
                    <div class="video-container-br">
                        <iframe width="900" height="506" src="https://www.youtube.com/embed/eogpIG53Cis?si=YOCkh4p6gBUNdoAw&autoplay=1" title="Blade Runner soundtrack" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
                    </div>
                    
                    <div class="data-stream">
                        <div class="data-line">>>> INITIALIZING MEMORY CORE...</div>
                        <div class="data-line">>>> SCANNING FOR REPLICANTS...</div>
                        <div class="data-line">>>> NEURAL PATHWAYS: ACTIVE</div>
                        <div class="data-line">>>> SEEK AND FIND PROTOCOL: ENGAGED</div>
                    </div>
                </div>
            </div>
            
            <div class="hud-elements">
                <div class="hud-corner hud-top-left"></div>
                <div class="hud-corner hud-top-right"></div>
                <div class="hud-corner hud-bottom-left"></div>
                <div class="hud-corner hud-bottom-right"></div>
            </div>
            
            <div class="hologram-text">
                <span class="glitch-text">THE HUNT CONTINUES...</span>
            </div>
            
            <div class="navigation-panel" id="navigationPanel" style="opacity: 0; pointer-events: none; transition: opacity 1s ease-in-out;">
                <button class="nav-button" onclick="window.location.href='blade-runner-vk.html'">
                    <span class="button-text">PROCEED TO VOIGHT-KAMPFF TEST</span>
                    <span class="button-subtext">PSYCHOLOGICAL EVALUATION REQUIRED</span>
                </button>
            </div>
        </main>
        
        <footer class="footer">
            <p class="footer-text">
                <span class="blink">█</span> NEXUS-6 PROTOCOL ACTIVE <span class="blink">█</span>
            </p>
        </footer>
    </div>
    
    <audio autoplay loop id="backgroundMusic" preload="auto" controls style="position: fixed; bottom: 10px; left: 10px; opacity: 0.3; z-index: 1000;">
        <source src="assets/audio/love-theme-1.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    
    <script>
        // Ensure background music plays in separate channel
        document.addEventListener('DOMContentLoaded', function() {
            const music = document.getElementById('backgroundMusic');
            const iframe = document.querySelector('iframe');
            
            console.log('Background music element:', music);
            console.log('Music ready state:', music ? music.readyState : 'No music element');
            
            if (!music) {
                console.error('Background music element not found!');
                return;
            }
            
            // Set background music properties
            music.volume = 0.8;
            music.loop = true;
            // Removed crossOrigin to avoid potential CORS issues
            
            // Create separate audio context for background music
            if (window.AudioContext || window.webkitAudioContext) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const source = audioContext.createMediaElementSource(music);
                    const gainNode = audioContext.createGain();
                    
                    gainNode.gain.value = 0.8;
                    source.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                } catch(e) {
                    console.log('AudioContext not available, using standard audio');
                }
            }
            
            // Lower iframe video volume to prevent conflict
            if (iframe) {
                iframe.onload = function() {
                    try {
                        // Try to communicate with iframe (may be blocked by CORS)
                        iframe.contentWindow.postMessage('{"event":"command","func":"setVolume","args":[0.3]}', '*');
                    } catch(e) {
                        console.log('Cannot control iframe volume due to CORS');
                    }
                };
            }
            
            // Enhanced music startup function
            let musicStarted = false;
            function startMusic() {
                if (!musicStarted && music) {
                    // Reset audio properties
                    music.volume = 0.8;
                    music.loop = true;
                    
                    // Attempt to play
                    music.play().then(() => {
                        musicStarted = true;
                        console.log('Background music started successfully');
                        
                        // Show audio indicator
                        const indicator = document.getElementById('audioIndicator');
                        if (indicator) {
                            indicator.style.opacity = '1';
                            indicator.style.display = 'block';
                            setTimeout(() => {
                                indicator.style.opacity = '0.7';
                            }, 3000);
                        }
                    }).catch(e => {
                        console.log('Background music failed:', e);
                        // Try again after a short delay
                        setTimeout(() => {
                            if (!musicStarted) {
                                music.play().catch(e2 => console.log('Retry failed:', e2));
                            }
                        }, 1000);
                    });
                }
            }
            
            // Multiple startup attempts
            function initAudio() {
                // Immediate attempt
                startMusic();
                
                // Delayed attempts
                setTimeout(startMusic, 500);
                setTimeout(startMusic, 1500);
                setTimeout(startMusic, 3000);
            }
            
            // Try on page load
            initAudio();
            
            // Try on user interaction
            ['click', 'keydown', 'touchstart', 'mouseover', 'scroll', 'mousedown'].forEach(eventType => {
                document.addEventListener(eventType, startMusic, { once: true });
            });
            
            // Try when page is fully loaded
            window.addEventListener('load', initAudio);
            
            // Add audio event listeners for debugging
            music.addEventListener('loadstart', () => console.log('Audio: Load started'));
            music.addEventListener('loadeddata', () => console.log('Audio: Data loaded'));
            music.addEventListener('canplay', () => console.log('Audio: Can play'));
            music.addEventListener('canplaythrough', () => console.log('Audio: Can play through'));
            music.addEventListener('playing', () => console.log('Audio: Playing'));
            music.addEventListener('pause', () => console.log('Audio: Paused'));
            music.addEventListener('error', (e) => console.error('Audio error:', e));
            
            // Force audio properties
            music.volume = 0.8;
            music.preload = 'auto';
            
            // Show navigation button after 10 seconds
            setTimeout(() => {
                const navPanel = document.getElementById('navigationPanel');
                if (navPanel) {
                    navPanel.style.opacity = '1';
                    navPanel.style.pointerEvents = 'auto';
                }
            }, 10000); // 10 seconds delay
        });
    </script>
</body>
</html>
